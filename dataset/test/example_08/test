#! /opt/homebrew/Cellar/icarus-verilog/12.0/bin/vvp
:ivl_version "12.0 (stable)";
:ivl_delay_selection "TYPICAL";
:vpi_time_precision - 12;
:vpi_module "/opt/homebrew/Cellar/icarus-verilog/12.0/lib/ivl/system.vpi";
:vpi_module "/opt/homebrew/Cellar/icarus-verilog/12.0/lib/ivl/vhdl_sys.vpi";
:vpi_module "/opt/homebrew/Cellar/icarus-verilog/12.0/lib/ivl/vhdl_textio.vpi";
:vpi_module "/opt/homebrew/Cellar/icarus-verilog/12.0/lib/ivl/v2005_math.vpi";
:vpi_module "/opt/homebrew/Cellar/icarus-verilog/12.0/lib/ivl/va_math.vpi";
S_0x12e60bd60 .scope module, "tb_lfsr_taps3_5" "tb_lfsr_taps3_5" 2 3;
 .timescale -9 -12;
v0x60000110c750_0 .var "clk", 0 0;
v0x60000110c7e0 .array "expected_sequence", 63 0, 5 0;
v0x60000110c870_0 .var "found_repeat", 0 0;
v0x60000110c900_0 .var/i "i", 31 0;
v0x60000110c990_0 .net "lfsr_out", 5 0, v0x60000110c630_0;  1 drivers
v0x60000110ca20_0 .var/i "pass_count", 31 0;
v0x60000110cab0_0 .var/i "period_length", 31 0;
v0x60000110cb40_0 .var "prev_value", 5 0;
v0x60000110cbd0_0 .var "rst", 0 0;
v0x60000110cc60_0 .var/i "test_count", 31 0;
v0x60000110ccf0_0 .var "test_passed", 0 0;
E_0x60000360adc0 .event posedge, v0x60000110c510_0;
E_0x60000360ae00 .event negedge, v0x60000110c510_0;
S_0x12e60a390 .scope function.vec4.s6, "calculate_next_lfsr" "calculate_next_lfsr" 2 34, 2 34 0, S_0x12e60bd60;
 .timescale -9 -12;
; Variable calculate_next_lfsr is vec4 return value of scope S_0x12e60a390
v0x60000110c2d0_0 .var "current", 5 0;
v0x60000110c360_0 .var "feedback", 0 0;
TD_tb_lfsr_taps3_5.calculate_next_lfsr ;
    %load/vec4 v0x60000110c2d0_0;
    %parti/s 1, 2, 3;
    %load/vec4 v0x60000110c2d0_0;
    %parti/s 1, 4, 4;
    %xor;
    %store/vec4 v0x60000110c360_0, 0, 1;
    %load/vec4 v0x60000110c2d0_0;
    %parti/s 5, 0, 2;
    %load/vec4 v0x60000110c360_0;
    %concat/vec4; draw_concat_vec4
    %ret/vec4 0, 0, 6;  Assign to calculate_next_lfsr (store_vec4_to_lval)
    %end;
S_0x12e604980 .scope module, "uut" "lfsr_taps3_5" 2 27, 3 1 0, S_0x12e60bd60;
 .timescale -9 -12;
    .port_info 0 /INPUT 1 "clk";
    .port_info 1 /INPUT 1 "rst";
    .port_info 2 /OUTPUT 6 "lfsr_out";
L_0x60000080da40 .functor XOR 1, L_0x60000120c140, L_0x60000120c1e0, C4<0>, C4<0>;
v0x60000110c3f0_0 .net *"_ivl_1", 0 0, L_0x60000120c140;  1 drivers
v0x60000110c480_0 .net *"_ivl_3", 0 0, L_0x60000120c1e0;  1 drivers
v0x60000110c510_0 .net "clk", 0 0, v0x60000110c750_0;  1 drivers
v0x60000110c5a0_0 .net "feedback", 0 0, L_0x60000080da40;  1 drivers
v0x60000110c630_0 .var "lfsr_out", 5 0;
v0x60000110c6c0_0 .net "rst", 0 0, v0x60000110cbd0_0;  1 drivers
E_0x60000360ae40 .event posedge, v0x60000110c6c0_0, v0x60000110c510_0;
L_0x60000120c140 .part v0x60000110c630_0, 2, 1;
L_0x60000120c1e0 .part v0x60000110c630_0, 4, 1;
    .scope S_0x12e604980;
T_1 ;
    %wait E_0x60000360ae40;
    %load/vec4 v0x60000110c6c0_0;
    %flag_set/vec4 8;
    %jmp/0xz  T_1.0, 8;
    %pushi/vec4 1, 0, 6;
    %assign/vec4 v0x60000110c630_0, 0;
    %jmp T_1.1;
T_1.0 ;
    %load/vec4 v0x60000110c630_0;
    %parti/s 5, 0, 2;
    %load/vec4 v0x60000110c5a0_0;
    %concat/vec4; draw_concat_vec4
    %assign/vec4 v0x60000110c630_0, 0;
T_1.1 ;
    %jmp T_1;
    .thread T_1;
    .scope S_0x12e60bd60;
T_2 ;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0x60000110ccf0_0, 0, 1;
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0x60000110cc60_0, 0, 32;
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0x60000110ca20_0, 0, 32;
    %end;
    .thread T_2;
    .scope S_0x12e60bd60;
T_3 ;
    %delay 5000, 0;
    %load/vec4 v0x60000110c750_0;
    %inv;
    %store/vec4 v0x60000110c750_0, 0, 1;
    %jmp T_3;
    .thread T_3;
    .scope S_0x12e60bd60;
T_4 ;
    %vpi_call 2 45 "$display", "\012================== TESTBENCH START ==================" {0 0 0};
    %vpi_call 2 46 "$display", "Problem 8: LFSR with taps at bit 3 and bit 5" {0 0 0};
    %vpi_call 2 47 "$display", "Description: 6-bit LFSR with XOR feedback from bits [2] and [4]" {0 0 0};
    %vpi_call 2 48 "$display", "====================================================\012" {0 0 0};
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110c750_0, 0, 1;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0x60000110cbd0_0, 0, 1;
    %delay 20000, 0;
    %load/vec4 v0x60000110cc60_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110cc60_0, 0, 32;
    %load/vec4 v0x60000110c990_0;
    %cmpi/ne 0, 0, 6;
    %jmp/0xz  T_4.0, 6;
    %vpi_call 2 58 "$display", "Test %0d: PASS - Reset sets LFSR to non-zero value: %b", v0x60000110cc60_0, v0x60000110c990_0 {0 0 0};
    %load/vec4 v0x60000110ca20_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110ca20_0, 0, 32;
    %jmp T_4.1;
T_4.0 ;
    %vpi_call 2 61 "$display", "Test %0d: FAIL - LFSR is all zeros after reset (invalid seed)", v0x60000110cc60_0 {0 0 0};
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110ccf0_0, 0, 1;
T_4.1 ;
    %load/vec4 v0x60000110c990_0;
    %store/vec4 v0x60000110cb40_0, 0, 6;
    %wait E_0x60000360ae00;
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110cbd0_0, 0, 1;
    %vpi_call 2 73 "$display", "\012Testing LFSR sequence (first 10 values):" {0 0 0};
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0x60000110c900_0, 0, 32;
T_4.2 ;
    %load/vec4 v0x60000110c900_0;
    %cmpi/s 10, 0, 32;
    %jmp/0xz T_4.3, 5;
    %wait E_0x60000360adc0;
    %delay 1000, 0;
    %load/vec4 v0x60000110cc60_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110cc60_0, 0, 32;
    %load/vec4 v0x60000110cb40_0;
    %store/vec4 v0x60000110c2d0_0, 0, 6;
    %callf/vec4 TD_tb_lfsr_taps3_5.calculate_next_lfsr, S_0x12e60a390;
    %ix/getv/s 4, v0x60000110c900_0;
    %store/vec4a v0x60000110c7e0, 4, 0;
    %load/vec4 v0x60000110c900_0;
    %addi 1, 0, 32;
    %vpi_call 2 81 "$display", "  Cycle %0d: prev=%b, expected=%b, got=%b", S<0,vec4,s32>, v0x60000110cb40_0, &A<v0x60000110c7e0, v0x60000110c900_0 >, v0x60000110c990_0 {1 0 0};
    %load/vec4 v0x60000110c990_0;
    %ix/getv/s 4, v0x60000110c900_0;
    %load/vec4a v0x60000110c7e0, 4;
    %cmp/e;
    %jmp/0xz  T_4.4, 6;
    %load/vec4 v0x60000110ca20_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110ca20_0, 0, 32;
    %jmp T_4.5;
T_4.4 ;
    %vpi_call 2 87 "$display", "    FAIL - Incorrect LFSR value" {0 0 0};
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110ccf0_0, 0, 1;
T_4.5 ;
    %load/vec4 v0x60000110c990_0;
    %store/vec4 v0x60000110cb40_0, 0, 6;
    %load/vec4 v0x60000110c900_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110c900_0, 0, 32;
    %jmp T_4.2;
T_4.3 ;
    %vpi_call 2 95 "$display", "\012Checking for all-zero state (running 100 cycles):" {0 0 0};
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110c870_0, 0, 1;
    %pushi/vec4 10, 0, 32;
    %store/vec4 v0x60000110c900_0, 0, 32;
T_4.6 ;
    %load/vec4 v0x60000110c900_0;
    %cmpi/s 100, 0, 32;
    %jmp/0xz T_4.7, 5;
    %wait E_0x60000360adc0;
    %delay 1000, 0;
    %load/vec4 v0x60000110c990_0;
    %cmpi/e 0, 0, 6;
    %jmp/0xz  T_4.8, 6;
    %vpi_call 2 102 "$display", "  FAIL: LFSR reached all-zero state at cycle %0d", v0x60000110c900_0 {0 0 0};
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110ccf0_0, 0, 1;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0x60000110c870_0, 0, 1;
T_4.8 ;
    %load/vec4 v0x60000110c900_0;
    %cmpi/s 64, 0, 32;
    %jmp/0xz  T_4.10, 5;
    %load/vec4 v0x60000110c990_0;
    %ix/getv/s 4, v0x60000110c900_0;
    %store/vec4a v0x60000110c7e0, 4, 0;
T_4.10 ;
    %load/vec4 v0x60000110c900_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110c900_0, 0, 32;
    %jmp T_4.6;
T_4.7 ;
    %load/vec4 v0x60000110c870_0;
    %nor/r;
    %flag_set/vec4 8;
    %jmp/0xz  T_4.12, 8;
    %load/vec4 v0x60000110cc60_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110cc60_0, 0, 32;
    %load/vec4 v0x60000110ca20_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110ca20_0, 0, 32;
    %vpi_call 2 114 "$display", "  PASS: LFSR never reached all-zero state" {0 0 0};
T_4.12 ;
    %wait E_0x60000360adc0;
    %load/vec4 v0x60000110c990_0;
    %store/vec4 v0x60000110cb40_0, 0, 6;
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110c870_0, 0, 1;
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0x60000110c900_0, 0, 32;
T_4.14 ;
    %load/vec4 v0x60000110c900_0;
    %cmpi/s 10, 0, 32;
    %jmp/0xz T_4.15, 5;
    %wait E_0x60000360adc0;
    %load/vec4 v0x60000110c990_0;
    %load/vec4 v0x60000110cb40_0;
    %cmp/e;
    %jmp/0xz  T_4.16, 6;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0x60000110c870_0, 0, 1;
T_4.16 ;
    %load/vec4 v0x60000110c900_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110c900_0, 0, 32;
    %jmp T_4.14;
T_4.15 ;
    %load/vec4 v0x60000110cc60_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110cc60_0, 0, 32;
    %load/vec4 v0x60000110c870_0;
    %nor/r;
    %flag_set/vec4 8;
    %jmp/0xz  T_4.18, 8;
    %vpi_call 2 131 "$display", "\012Test %0d: PASS - LFSR is changing (not stuck)", v0x60000110cc60_0 {0 0 0};
    %load/vec4 v0x60000110ca20_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110ca20_0, 0, 32;
    %jmp T_4.19;
T_4.18 ;
    %vpi_call 2 134 "$display", "\012Test %0d: WARNING - LFSR might be stuck", v0x60000110cc60_0 {0 0 0};
T_4.19 ;
    %vpi_call 2 138 "$display", "\012Checking LFSR period:" {0 0 0};
    %wait E_0x60000360ae00;
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0x60000110cbd0_0, 0, 1;
    %wait E_0x60000360adc0;
    %wait E_0x60000360ae00;
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110cbd0_0, 0, 1;
    %wait E_0x60000360adc0;
    %delay 1000, 0;
    %load/vec4 v0x60000110c990_0;
    %store/vec4 v0x60000110cb40_0, 0, 6;
    %pushi/vec4 0, 0, 32;
    %store/vec4 v0x60000110cab0_0, 0, 32;
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110c870_0, 0, 1;
    %pushi/vec4 1, 0, 32;
    %store/vec4 v0x60000110c900_0, 0, 32;
T_4.20 ;
    %load/vec4 v0x60000110c900_0;
    %cmpi/s 65, 0, 32;
    %flag_or 5, 4;
    %flag_get/vec4 5;
    %jmp/0 T_4.22, 5;
    %load/vec4 v0x60000110c870_0;
    %nor/r;
    %and;
T_4.22;
    %flag_set/vec4 8;
    %jmp/0xz T_4.21, 8;
    %wait E_0x60000360adc0;
    %delay 1000, 0;
    %load/vec4 v0x60000110cab0_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110cab0_0, 0, 32;
    %load/vec4 v0x60000110c990_0;
    %load/vec4 v0x60000110cb40_0;
    %cmp/e;
    %jmp/0xz  T_4.23, 6;
    %vpi_call 2 160 "$display", "  Found period of length %0d", v0x60000110cab0_0 {0 0 0};
    %pushi/vec4 1, 0, 1;
    %store/vec4 v0x60000110c870_0, 0, 1;
T_4.23 ;
    %load/vec4 v0x60000110c900_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110c900_0, 0, 32;
    %jmp T_4.20;
T_4.21 ;
    %load/vec4 v0x60000110cc60_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110cc60_0, 0, 32;
    %load/vec4 v0x60000110cab0_0;
    %cmpi/e 63, 0, 32;
    %jmp/0xz  T_4.25, 4;
    %vpi_call 2 167 "$display", "  PASS: LFSR has maximal period (63)" {0 0 0};
    %load/vec4 v0x60000110ca20_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110ca20_0, 0, 32;
    %jmp T_4.26;
T_4.25 ;
    %load/vec4 v0x60000110cab0_0;
    %cmpi/s 0, 0, 32;
    %flag_or 5, 4; GT is !LE
    %flag_inv 5;
    %flag_get/vec4 5;
    %jmp/0 T_4.29, 5;
    %load/vec4 v0x60000110cab0_0;
    %cmpi/s 63, 0, 32;
    %flag_get/vec4 5;
    %and;
T_4.29;
    %flag_set/vec4 8;
    %jmp/0xz  T_4.27, 8;
    %vpi_call 2 170 "$display", "  WARNING: LFSR has non-maximal period (%0d)", v0x60000110cab0_0 {0 0 0};
    %jmp T_4.28;
T_4.27 ;
    %vpi_call 2 173 "$display", "  INFO: Period length = %0d", v0x60000110cab0_0 {0 0 0};
T_4.28 ;
T_4.26 ;
    %vpi_call 2 177 "$display", "\012Verifying shift operation:" {0 0 0};
    %wait E_0x60000360adc0;
    %delay 1000, 0;
    %load/vec4 v0x60000110c990_0;
    %store/vec4 v0x60000110cb40_0, 0, 6;
    %wait E_0x60000360adc0;
    %delay 1000, 0;
    %load/vec4 v0x60000110cc60_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110cc60_0, 0, 32;
    %load/vec4 v0x60000110c990_0;
    %parti/s 5, 1, 2;
    %load/vec4 v0x60000110cb40_0;
    %parti/s 5, 0, 2;
    %cmp/e;
    %jmp/0xz  T_4.30, 6;
    %vpi_call 2 187 "$display", "  PASS: Shift operation correct (left shift)" {0 0 0};
    %load/vec4 v0x60000110ca20_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110ca20_0, 0, 32;
    %jmp T_4.31;
T_4.30 ;
    %load/vec4 v0x60000110c990_0;
    %parti/s 5, 0, 2;
    %load/vec4 v0x60000110cb40_0;
    %parti/s 5, 1, 2;
    %cmp/e;
    %jmp/0xz  T_4.32, 6;
    %vpi_call 2 190 "$display", "  PASS: Shift operation correct (right shift)" {0 0 0};
    %load/vec4 v0x60000110ca20_0;
    %addi 1, 0, 32;
    %store/vec4 v0x60000110ca20_0, 0, 32;
    %jmp T_4.33;
T_4.32 ;
    %vpi_call 2 193 "$display", "  FAIL: Shift operation incorrect" {0 0 0};
    %vpi_call 2 194 "$display", "    Previous: %b", v0x60000110cb40_0 {0 0 0};
    %vpi_call 2 195 "$display", "    Current:  %b", v0x60000110c990_0 {0 0 0};
    %pushi/vec4 0, 0, 1;
    %store/vec4 v0x60000110ccf0_0, 0, 1;
T_4.33 ;
T_4.31 ;
    %delay 10000, 0;
    %vpi_call 2 201 "$display", "\012================== TEST RESULTS ====================" {0 0 0};
    %vpi_call 2 202 "$display", "Tests run: %0d", v0x60000110cc60_0 {0 0 0};
    %vpi_call 2 203 "$display", "Tests passed: %0d", v0x60000110ca20_0 {0 0 0};
    %load/vec4 v0x60000110cc60_0;
    %load/vec4 v0x60000110ca20_0;
    %sub;
    %vpi_call 2 204 "$display", "Tests failed: %0d", S<0,vec4,s32> {1 0 0};
    %load/vec4 v0x60000110ccf0_0;
    %flag_set/vec4 9;
    %flag_get/vec4 9;
    %jmp/0 T_4.36, 9;
    %load/vec4 v0x60000110cc60_0;
    %subi 1, 0, 32;
    %load/vec4 v0x60000110ca20_0;
    %cmp/s;
    %flag_get/vec4 4;
    %flag_get/vec4 5;
    %or;
    %and;
T_4.36;
    %flag_set/vec4 8;
    %jmp/0xz  T_4.34, 8;
    %vpi_call 2 207 "$display", "\012RESULT: ALL TESTS PASSED \342\234\223" {0 0 0};
    %jmp T_4.35;
T_4.34 ;
    %vpi_call 2 209 "$display", "\012RESULT: TESTS FAILED \342\234\227" {0 0 0};
T_4.35 ;
    %vpi_call 2 211 "$display", "====================================================\012" {0 0 0};
    %vpi_call 2 213 "$finish" {0 0 0};
    %end;
    .thread T_4;
    .scope S_0x12e60bd60;
T_5 ;
    %delay 100000000, 0;
    %vpi_call 2 219 "$display", "\012ERROR: Timeout - Test did not complete" {0 0 0};
    %vpi_call 2 220 "$finish" {0 0 0};
    %end;
    .thread T_5;
# The file index is used to find the file name in the following table.
:file_names 4;
    "N/A";
    "<interactive>";
    "testbench.v";
    "solution.v";
