# This Dockerfile onnly for GH action runs and performs:
#   1) Code lint checking
#   2) Runs tests from tests/

FROM ubuntu:22.04

# Prevent interactive prompts
ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=UTC

# Install build dependency tools
RUN apt-get update && apt-get install -y \
    curl \
    python3 \
    python3-pip \
    iverilog \
    yosys \
    && apt-get clean

# Install uv
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.local/bin:${PATH}"

# Work directory of the application
WORKDIR /src
# Copy from source to src/
COPY . .

# Install ruff for linting
RUN uv pip install ruff

# Step 1: Code lint checking with ruff
RUN echo "=== Running Code Linting ===" && \
    ruff check . && \
    ruff format --check .

# Step 2: Run tests
RUN echo "=== Running Tests ===" && \
    uv run pytest -v tests/test_models::test_api_connection_with_no_env_load
