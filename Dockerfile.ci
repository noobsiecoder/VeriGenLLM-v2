# This Dockerfile onnly for GH action runs and performs:
#   1) Code lint checking
#   2) Runs tests from tests/

FROM alpine:latest

# INstall buold dependency tools
RUN apk add --no-cache \
    # Basic tools
    curl \
    git \
    python3 \
    py3-pip \
    # Build tools
    build-base \
    cmake \
    # For Yosys
    bison \
    flex \
    gawk \
    tcl-dev \
    libffi-dev \
    readline-dev \
    graphviz \
    # Boost libraries (Alpine names)
    boost-dev \
    boost-python3 \
    # Other deps
    zlib-dev \
    # Verilog tools
    iverilog \
    yosys

# Install uv via curl
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
# Add uv to PATH
ENV PATH="/root/.cargo/bin:${PATH}"

WORKDIR /src # Work directory of the application
COPY . .

# Pilot run (test)
RUN uv run python main.py || echo "Expected: no argument matches"
